<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCT Match Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>
            <img src="{{ url_for('static', filename='VCT_2023_Americas.png') }}" alt="VCT Americas Logo" class="logo-image">
            VCT Americas: Stage 2 Group Stage Match Predictor
        </h1>
        <p class="description-text">
            This "Predictor" Tool allows a simple prediction of the winner of a match between two VCT Americas teams during Stage 2 Group Stage.
        </p>
        
        <!-- Group Standings -->
        <div class="group-standings">
            <h2 class="standings-title">Current Stage 2 Group Standings</h2>
            
            {% for group, teams in teams_by_group.items() %}
            <div class="group-section">
                <h3 class="group-title">Group {{ group }}</h3>
                <div class="group-teams">
                    {% for team in teams %}
                    <div class="team-row">
                        <div class="team-info">
                            <span class="team-name-standings">{{ team.name }}</span>
                            <span class="team-record-standings">REC: {{ team.record }}</span>
                            <span class="team-record-standings">MAP: {{ team.map_diff }}</span>
                            <span class="team-record-standings">RND: {{ team.round_diff }}</span>
                            <span class="team-record-standings {% if team.delta > 0 %}delta-positive{% elif team.delta < 0 %}delta-negative{% else %}delta-zero{% endif %}">Œî: {{ team.delta }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Prediction Form -->
        <form method="POST" id="predictionForm" novalidate>
            <div class="form-group">
                <label for="team1" id="team1Label">Team 1:</label>
                <select name="team1" id="team1" required aria-labelledby="team1Label" aria-describedby="team1Help">
                    <option value="">-- Select Team 1 --</option>
                    <optgroup label="Group Alpha">
                        {% for team in teams_by_group.Alpha %}
                            <option value="{{ team.name }}" {% if team.name == selected_team1 %}selected{% endif %}>
                                {{ team.name }} ({{ team.record }})
                            </option>
                        {% endfor %}
                    </optgroup>
                    <optgroup label="Group Omega">
                        {% for team in teams_by_group.Omega %}
                            <option value="{{ team.name }}" {% if team.name == selected_team1 %}selected{% endif %}>
                                {{ team.name }} ({{ team.record }})
                            </option>
                        {% endfor %}
                    </optgroup>
                </select>
                <div id="team1Help" class="help-text help-text-inline">
                    Please select a team
                </div>
            </div>
            
            <div class="form-group">
                <label for="team2" id="team2Label">Team 2:</label>
                <select name="team2" id="team2" required aria-labelledby="team2Label" aria-describedby="team2Help">
                    <option value="">-- Select Team 2 --</option>
                    <optgroup label="Group Alpha">
                        {% for team in teams_by_group.Alpha %}
                            <option value="{{ team.name }}" {% if team.name == selected_team2 %}selected{% endif %}>
                                {{ team.name }} ({{ team.record }})
                            </option>
                        {% endfor %}
                    </optgroup>
                    <optgroup label="Group Omega">
                        {% for team in teams_by_group.Omega %}
                            <option value="{{ team.name }}" {% if team.name == selected_team2 %}selected{% endif %}>
                                {{ team.name }} ({{ team.record }})
                            </option>
                        {% endfor %}
                    </optgroup>
                </select>
                <div id="team2Help" class="help-text help-text-inline">
                    Please select a team from the same group
                </div>
            </div>
            
            <button type="submit" class="predict-button" id="predictButton" disabled>
                 Predict Match Winner
            </button>
        </form>
        
        <div class="note-text">
            <p>üìã <strong>Note:</strong> Teams can only play against other teams in their own group during the group stage.</p>
        </div>
        
        <!-- Error Display -->
        {% if error_message %}
            <div class="error">
                ‚ö†Ô∏è {{ error_message }}
            </div>
        {% endif %}
        
        <!-- Prediction Results -->
        {% if prediction %}
            <div class="prediction-result" role="region" aria-label="Match prediction results">
                <h2 class="prediction-title">
                    Match Prediction Results
                </h2>
                
                <div class="team-stats">
                    <div class="team-stat">
                        <div class="team-name">{{ prediction.team1|upper }}</div>
                        <div class="win-rate">
                            Win Rate: {{ "%.1f"|format(prediction.team1_win_rate * 100) }}%
                        </div>
                        <div class="records">
                            ({{ prediction.team1_record.wins }}W - {{ prediction.team1_record.losses }}L)
                        </div>
                        <div class="match-probability">
                            {{ "%.0f"|format(prediction.team1_match_probability * 100) }}% chance
                        </div>
                    </div>
                    
                    <div class="vs" aria-hidden="true">VS</div>
                    
                    <div class="team-stat">
                        <div class="team-name">{{ prediction.team2|upper }}</div>
                        <div class="win-rate">
                            Win Rate: {{ "%.1f"|format(prediction.team2_win_rate * 100) }}%
                        </div>
                        <div class="records">
                            ({{ prediction.team2_record.wins }}W - {{ prediction.team2_record.losses }}L)
                        </div>
                        <div class="match-probability">
                            {{ "%.0f"|format(prediction.team2_match_probability * 100) }}% chance
                        </div>
                    </div>
                </div>
                
                <div class="winner" role="alert">
                     Predicted Winner: {{ prediction.predicted_winner|upper }}
                    <br>
                    <span class="confidence-text">
                        ({{ "%.0f"|format(prediction.confidence * 100) }}% confidence)
                    </span>
                </div>
            </div>
        {% endif %}
        
        <!-- Last Updated Info -->
        <div class="last-updated">
            {% if last_updated %}
                Last updated: {{ last_updated.strftime('%Y-%m-%d %H:%M UTC') }}
            {% endif %}
        </div>
        
        <!-- Scraper Health Status -->
        <div class="health-status">
            <h3 class="health-title">üîÑ Auto-Scraper Status</h3>
            <div class="health-grid">
                <div class="health-item">
                    <span class="health-label">Last Run:</span>
                    <span class="health-value" id="lastRun">Loading...</span>
                </div>
                <div class="health-item">
                    <span class="health-label">Status:</span>
                    <span class="health-value" id="scraperStatus">Loading...</span>
                </div>
                <div class="health-item">
                    <span class="health-label">Success Rate:</span>
                    <span class="health-value" id="successRate">Loading...</span>
                </div>
                <div class="health-item">
                    <span class="health-label">Total Runs:</span>
                    <span class="health-value" id="totalRuns">Loading...</span>
                </div>
            </div>
            <div class="health-message" id="healthMessage"></div>
        </div>
        
        <!-- Instructions for first-time users -->
        {% if not prediction and not error_message %}
            <div class="instructions-box">
                <h3 class="instructions-title">How it works:</h3>
                <ol class="instructions-list">
                    <li>Select two teams from the dropdowns above</li>
                    <li>Click "Predict Match Winner"</li>
                    <li>See the prediction based on recent team performance</li>
                </ol>
                <p class="instructions-paragraph">
                    <strong>Note:</strong> Predictions are based on recent win/loss records. 
                </p>
            </div>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>