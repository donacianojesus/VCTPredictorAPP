<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCT Match Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VCT Predictor</h1>
            <p>Predict match outcomes based on current VCT 2025 Stage 2 Americas standings</p>
            <div class="update-section">
                <div class="button-group">
                    <button id="updateDataBtn" class="update-btn">
                        <span class="btn-text">üîÑ Update VCT Data</span>
                        <span class="loading-spinner" style="display: none;">‚è≥</span>
                    </button>
                    <button id="resetDataBtn" class="reset-btn">
                        <span class="btn-text">üóëÔ∏è Reset Database</span>
                        <span class="loading-spinner" style="display: none;">‚è≥</span>
                    </button>
                    <button id="completeResetBtn" class="complete-reset-btn">
                        <span class="btn-text">üîÑ Complete Reset</span>
                        <span class="loading-spinner" style="display: none;">‚è≥</span>
                    </button>
                </div>
                <div id="updateStatus" class="update-status"></div>
            </div>
        </div>
        
        <!-- Group Standings -->
        {% if teams_with_stats and teams_with_stats|length >= 10 %}
            <div class="standings-section">
                <h2>Current VCT 2025 Stage 2 Americas Standings</h2>
                
                <!-- Group Alpha -->
                <div class="group-section">
                    <h3>Group Alpha</h3>
                    <div class="standings-table">
                        <div class="table-header">
                            <span class="team-name">Team</span>
                            <span class="record">Record</span>
                            <span class="map-diff">Map Diff</span>
                            <span class="round-diff">Round Diff</span>
                            <span class="delta">Œî</span>
                        </div>
                        {% for team in teams_with_stats if team.group_name == 'Alpha' %}
                        <div class="team-row">
                            <span class="team-name">{{ team.team }}</span>
                            <span class="record">{{ team.record }}</span>
                            <span class="map-diff">{{ team.map_diff }}</span>
                            <span class="round-diff">{{ team.round_diff }}</span>
                            <span class="delta {% if team.delta > 0 %}positive{% elif team.delta < 0 %}negative{% endif %}">
                                {{ team.delta }}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Group Omega -->
                <div class="group-section">
                    <h3>Group Omega</h3>
                    <div class="standings-table">
                        <div class="table-header">
                            <span class="team-name">Team</span>
                            <span class="record">Record</span>
                            <span class="map-diff">Map Diff</span>
                            <span class="round-diff">Round Diff</span>
                            <span class="delta">Œî</span>
                        </div>
                        {% for team in teams_with_stats if team.group_name == 'Omega' %}
                        <div class="team-row">
                            <span class="team-name">{{ team.team }}</span>
                            <span class="record">{{ team.record }}</span>
                            <span class="map-diff">{{ team.map_diff }}</span>
                            <span class="round-diff">{{ team.round_diff }}</span>
                            <span class="delta {% if team.delta > 0 %}positive{% elif team.delta < 0 %}negative{% endif %}">
                                {{ team.delta }}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                {% if last_updated %}
                <div class="last-updated">
                    <p>Last updated: {{ last_updated.strftime('%Y-%m-%d %H:%M:%S') if last_updated else 'Unknown' }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Match Prediction Form -->
            <div class="prediction-section">
                <h2>Match Prediction</h2>
                <form method="POST" class="prediction-form">
                    <div class="team-selection">
                        <div class="team-selector">
                            <label for="team1">Team 1:</label>
                            <select name="team1" id="team1" required>
                                <option value="">Select Team 1</option>
                                {% for team in teams_with_stats %}
                                <option value="{{ team.id }}" {% if request.form.get('team1') == team.id|string %}selected{% endif %}>
                                    {{ team.team }} ({{ team.group_name }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="team-selector">
                            <label for="team2">Team 2:</label>
                            <select name="team2" id="team2" required>
                                <option value="">Select Team 2</option>
                                {% for team in teams_with_stats %}
                                <option value="{{ team.id }}" {% if request.form.get('team2') == team.id|string %}selected{% endif %}>
                                    {{ team.team }} ({{ team.group_name }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="predict-btn">Predict Winner</button>
                </form>

                {% if prediction_result %}
                    {% if prediction_result.error %}
                        <div class="prediction-result error">
                            <p>{{ prediction_result.error }}</p>
                        </div>
                    {% else %}
                        <div class="prediction-result">
                            <h3>Prediction Result</h3>
                            <p><strong>Winner:</strong> {{ prediction_result.winner }}</p>
                            <p><strong>Confidence:</strong> {{ prediction_result.confidence }}%</p>
                            {% if prediction_result.reasoning %}
                            <p><strong>Reasoning:</strong> {{ prediction_result.reasoning }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        {% else %}
            <!-- No Data Available -->
            <div class="no-data-section">
                <div class="no-data-content">
                    <h2>üìä No VCT Data Available</h2>
                    <p>There's no current tournament data in the database.</p>
                    <p>Click the <strong>"Update VCT Data"</strong> button above to fetch the latest VCT 2025 Stage 2 Americas standings.</p>
                    <div class="data-info">
                        <p><strong>What this will do:</strong></p>
                        <ul>
                            <li>Scrape current VCT 2025 Stage 2 Americas data from VLR.gg</li>
                            <li>Update the database with live tournament standings</li>
                            <li>Enable match predictions between teams</li>
                            <li>Show real-time group standings (Alpha & Omega)</li>
                        </ul>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if error_message %}
        <div class="error-message">
            <p>{{ error_message }}</p>
        </div>
        {% endif %}
        
        <!-- Scraper Health Status -->
        <div class="health-status">
            <h3 class="health-title">üîÑ Auto-Scraper Status</h3>
            <div class="health-grid">
                <div class="health-item">
                    <span class="health-label">Last Run:</span>
                    <span class="health-value" id="lastRun">Loading...</span>
                </div>
                <div class="health-item">
                    <span class="health-label">Status:</span>
                    <span class="health-value" id="scraperStatus">Loading...</span>
                </div>
                <div class="health-item">
                    <span class="health-label">Success Rate:</span>
                    <span class="health-value" id="successRate">Loading...</span>
                </div>
                <div class="health-item">
                    <span class="health-label">Total Runs:</span>
                    <span class="health-value" id="totalRuns">Loading...</span>
                </div>
            </div>
            <div class="health-message" id="healthMessage"></div>
        </div>
        
        <!-- Instructions for first-time users -->
        {% if not prediction_result and not error_message %}
            <div class="instructions-box">
                <h3 class="instructions-title">How it works:</h3>
                <ol class="instructions-list">
                    <li>Select two teams from the dropdowns above</li>
                    <li>Click "Predict Match Winner"</li>
                    <li>See the prediction based on recent team performance</li>
                </ol>
                <p class="instructions-paragraph">
                    <strong>Note:</strong> Predictions are based on recent win/loss records. 
                </p>
            </div>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>